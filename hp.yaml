#====================================================#
#     Final Clash Meta Profile - Focused Solution      #
#       TUN Mode + DNS Hijack + 5 Proxies Only         #
#====================================================#

mixed-port: 7890
allow-lan: true
mode: rule
log-level: info
external-controller: '127.0.0.1:9090'
secret: ''

# این بخش به کلش دستور می‌دهد که فقط از آدرس‌های IPv4 استفاده کند
# این یک لایه حفاظتی اضافه برای حل مشکل شماست
ipv6: false

# بخش DNS که تمام درخواست‌ها را مدیریت می‌کند
dns:
  enable: true
  listen: '0.0.0.0:1053'
  enhanced-mode: fake-ip
  fake-ip-range: '198.18.0.1/16'
  nameserver:
    - https://dns.google/dns-query
    - https://1.1.1.1/dns-query
  fallback:
    - https://dns.cloudflare.com/dns-query
  fake-ip-filter:
    - '*'
    - '+.lan'
    - '+.local'

# >> بخش کلیدی: حالت TUN برای کنترل کامل اینترنت <<
# این بخش تمام ترافیک سیستم را به کلش هدایت می‌کند
tun:
  enable: true
  stack: gvisor
  auto-route: true
  strict-route: true
  auto-detect-interface: true
  dns-hijack:
    - 'tcp://any:53'
    - 'udp://any:53'
  mtu: 1400 # MTU بهینه برای جلوگیری از fragment شدن بسته‌ها

# پراکسی‌ها: فقط ۵ کانفیگ اول شما (با اصلاحات ضروری)
proxies:
  # پراکسی اول از anytls به vless تغییر کرده تا برای کلش قابل فهم باشد
  - name: "🇩🇪 anytls-443"
    type: vless
    server: 80.240.26.147
    port: 443
    uuid: "qzJvszJHOB"
    tls: true
    servername: "suiany.makingirangreatagain.com"
    network: tcp
    udp: true

  # DNS داخلی از تمام کانفیگ‌های وایرگارد زیر حذف شده است
  - name: "🇩🇪 hamedp71-WG"
    type: wireguard
    server: 94.242.50.185
    port: 443
    ip: "100.80.234.177/32"
    private-key: "cIq+3tcHVT7gRMl4kIv0WE68ERiTmDtA7rhyHhLJ/mg="
    public-key: "Yom91OWyt0otz1S4hgQMhp1q1y8tpDvUWwVkNXpmpjc="
    pre-shared-key: "N/gfMZSjvP8mbXfVP2hnD5CX8BkGvOyheJ67mCpD+QQ="
    mtu: 1280

  - name: "🇩🇪 hamedp71-WG 2"
    type: wireguard
    server: 185.189.163.176
    port: 443
    ip: "100.80.234.177/32"
    private-key: "cIq+3tcHVT7gRMl4kIv0WE68ERiTmDtA7rhyHhLJ/mg="
    public-key: "dAAkV3G3YFurH3+3198clav9vlh4FxB1asqNc0tLeCk="
    pre-shared-key: "N/gfMZSjvP8mbXfVP2hnD5CX8BkGvOyheJ67mCpD+QQ="
    mtu: 1280

  - name: "🇦🇹 Austria-WG"
    type: wireguard
    server: 89.187.168.67
    port: 65142
    ip: "100.80.234.177/32"
    private-key: "cIq+3tcHVT7gRMl4kIv0WE68ERiTmDtA7rhyHhLJ/mg="
    public-key: "KtJIKy9zsCXtKwFMQeGDEZVXtqw+X1+5z10Rh84/N0s="
    pre-shared-key: "N/gfMZSjvP8mbXfVP2hnD5CX8BkGvOyheJ67mCpD+QQ="
    mtu: 1280

  - name: "🇦🇺 Australia-WG-1"
    type: wireguard
    server: 103.1.213.212
    port: 65142
    ip: "100.80.234.177/32"
    private-key: "cIq+3tcHVT7gRMl4kIv0WE68ERiTmDtA7rhyHhLJ/mg="
    public-key: "jCi1I5HBTtwCblBbMzOFmOOFNG1GilYOZgst0kyq9gY="
    pre-shared-key: "N/gfMZSjvP8mbXfVP2hnD5CX8BkGvOyheJ67mCpD+QQ="
    mtu: 1280

# گروه‌بندی پراکسی‌ها (ساده و کاربردی)
proxy-groups:
  - name: "PROXY 📲"
    type: select
    proxies:
      - "Auto ⚡️"
      - "🇩🇪 anytls-443"
      - "🇩🇪 hamedp71-WG"
      - "🇩🇪 hamedp71-WG 2"
      - "🇦🇹 Austria-WG"
      - "🇦🇺 Australia-WG-1"
      - DIRECT

  - name: "Auto ⚡️"
    type: url-test
    url: "http://www.gstatic.com/generate_204"
    interval: 300
    proxies:
      - "🇩🇪 anytls-443"
      - "🇩🇪 hamedp71-WG"
      - "🇩🇪 hamedp71-WG 2"
      - "🇦🇹 Austria-WG"
      - "🇦🇺 Australia-WG-1"

# قوانین مسیریابی (ساده و ضروری)
rules:
  - DOMAIN-SUFFIX,ir,DIRECT
  - GEOIP,IR,DIRECT
  - MATCH,PROXY 📲
